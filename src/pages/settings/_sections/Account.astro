---
import AccountInput from '../_components/AccountInput.astro';

const { user: { email, username, email_verified } } = Astro.locals
---
<div class="form-container">
  <form id="account_form">
    <AccountInput label="Username:" name="username" type="text" value={username} color="var(--accent-color)">
      {username}
    </AccountInput>
    <AccountInput label="Email:" name="email" type="email" value={email} color="var(--accent-color)">
      ******{email.split("@")[1]}
      <small class={email_verified ? 'verified' : 'unverified'} slot="footer">
        {email_verified ? 'Verified Account' : 'Verification Pending'}
      </small>
    </AccountInput>
    <br />
    <label for="password">Current Password:</label>
    <input type="password" id="current_password" name="current_password" />
    <label for="new_password">New Password:</label>
    <input type="password" id="new_password" name="new_password" />
  </form>
  <button type="submit" form="account_form">
      Guardar Cambios
  </button>
</div>

<style is:inline>
.form-container {
  display: flex;
  flex-direction: column;
  gap: 2rem;
  max-width: 770px;
  background: #ffffff0a;
  width: 100%;
  padding: 2rem;
  margin-top: 4rem;
  border-radius: 12px;
}

form {
    color: #fff;
    display: flex;
    flex-direction: column;
  gap: 2rem;

  & label {
    font-weight: 600;
  }
}
input {
    font-size: 1.5rem;
    font-weight: bold;
    z-index: 1;
    width: 100%;
    height: 100%;
    border: solid 1px #fff);
    border-radius: 6px;
    background-color: transparent;
    outline: none;
    padding: 1rem;
    color: white;
}
 button[type="submit"] {
    padding: 1rem;
    border-radius: 4px;
    border: none;
    background-color: rebeccapurple;
    color: white;
    margin-top: 1rem;
  &:hover {
    background-color: indigo;
  }
}

small.verified {
  color: limegreen;
  &:before {
    content: '✔ ';
  }
}

small.unverified {
  color: yellow;
  &:before {
    content: '⚠ ';
  }
}
</style>

<script is:inline>
const form = document.querySelector('form')
const ICONS = {
  edit: "icon-park-twotone:edit",
  save: "ic:twotone-save"
}

form?.addEventListener('click', toggleInput)

function toggleInput(event) {

  event.preventDefault()
  const element = event.target
  
  if(element.tagName !== 'BUTTON' && !element.closest('button')) return

  const parent = element.parentElement
  const input = parent.querySelector('input')
  const paragraph = parent.querySelector('p')
  const icon = parent.querySelector('iconify-icon')

  if(input.hidden) {
    input.hidden = false
    paragraph.hidden = true
    icon.setAttribute('icon', ICONS.save)
    return
  } 
  
  input.hidden = true
  paragraph.hidden = false
  paragraph.textContent = input.value
  icon.setAttribute('icon', ICONS.edit)
}

</script>
